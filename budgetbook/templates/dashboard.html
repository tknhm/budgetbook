<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>家計簿ダッシュボード</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="container mt-4">
  <div class="dashboard-header">
    <h1>家計簿ダッシュボード</h1>

    <div class="filter-box">
      <label>開始日</label>
      <input class="cal" type="date" id="start-date" />

      <label>終了日</label>
      <input class="cal" type="date" id="end-date" />

      <button id="filter-btn"><i class="fas fa-filter"></i>フィルタ</button>
      <button id="reset-btn" class="reset-btn">リセット</button>
    </div>
  </div>

  <!-- 一覧 -->
  <section id="lists">
    <h2>月別・支払い方法別支出</h2>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>支払い方法</th>
            {% for month in months %}
            <th>{{ month }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for method, month_data in payment_summary.items() %}
          <tr>
            <td>{{ method }}</td>
            {% for month in months %}
            <td>{{ month_data.get(month, 0) }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <h2>支出一覧</h2>
    <div class="table-container">
      <table id="expense-list">
        <thead>
          <tr>
            <th>日付</th>
            <th>カテゴリ</th>
            <th>店名</th>
            <th>金額</th>
            <th>支払い方法</th>
          </tr>
        </thead>
        <tbody>
          <!-- JSで埋める -->
        </tbody>
      </table>
    </div>

    <h2>収入一覧</h2>
    <div class="table-container">
      <table id="income-list">
        <thead>
          <tr>
            <th>日付</th>
            <th>カテゴリ</th>
            <th>金額</th>
          </tr>
        </thead>
        <tbody>
          <!-- JSで埋める -->
        </tbody>
      </table>
    </div>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}" />
  </section>

  <hr />

  <!-- グラフ -->
  <section id="charts">
    <h2>カテゴリ別支出</h2>
    <canvas id="expense-chart"></canvas>

    <h2>収支比較</h2>
    <canvas id="summary-chart"></canvas>

    <h2>収支の流れ（サンキー図）</h2>
    <div id="sankey-chart"></div>
  </section>

  <hr />

  <div class="row">
    <!-- 支出フォーム -->
    <div class="col-md-6">
      <h3>支出登録</h3>
      <form id="expense-form">
        <input type="date" name="date" class="form-control mb-2" required />
        <input type="text" name="shop" placeholder="お店" class="form-control mb-2" required />
        <input type="text" name="category" placeholder="カテゴリ" class="form-control mb-2" required />
        <input type="number" name="amount" placeholder="金額" class="form-control mb-2" required />
        <input type="text" name="payment" placeholder="支払い方法" class="form-control mb-2" required />
        <button type="submit" class="btn btn-primary">支出を登録</button>
      </form>
    </div>

    <!-- 収入フォーム -->
    <div class="col-md-6">
      <h3>収入登録</h3>
      <form id="income-form">
        <input type="date" name="date" class="form-control mb-2" required />
        <input type="text" name="category" placeholder="カテゴリ" class="form-control mb-2" required />
        <input type="number" name="amount" placeholder="金額" class="form-control mb-2" required />
        <button type="submit" class="btn btn-primary">収入を登録</button>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <!-- Google Charts -->
  <script src="https://www.gstatic.com/charts/loader.js" type="text/javascript"></script>
  <!-- 自作のJS -->
  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
  <script>
    google.charts.load("current", { "packages": ["sankey"] });
    google.charts.setOnLoadCallback(drawSankeyChart);
  </script>

</body>

</html>